{% extends "base.html" %}

{% load ietf_filters %}

{% block title %}Liaison statement: {% include 'liaisons/liaison_title.html' %}{% endblock %}


{% block content %}
  <h1>
    Liaison statement<br><small>{% include 'liaisons/liaison_title.html' %}</small>
  </h1>

<table class="ietf-liaison-details">
<tr>
  <td style="width:18ex;">Submission Date:</td>
  <td>{{ liaison.submitted|date:"Y-m-d" }}</td></tr>
{% if liaison.from_contact %}<tr>
  <td>Sender:</td>
  <td>
    <a href="mailto:{{ liaison.from_contact.address }}">{{ liaison.from_contact.person }}</a>
  </td>
</tr>{% endif %}
<tr>
  <td>From:</td>
  <td>
    {% for group in liaison.from_groups.all %}
      {{ group.name }}
    {% empty %}
      {{ liaison.from_name }}
    {% endfor %}
  </td>
</tr>

    {% for group in liaison.to_groups.all %}
      {{ group.name }}
    {% empty %}
      {{ liaison.to_name }}
    {% endfor %}

{% if liaison.from_contact %}
  <tr>
    <td>Cc:</td><td>{{ liaison.cc_contacts|parse_email_list|make_one_per_line|safe|linebreaksbr }}</td>
  </tr>

  <tr>
    <td>Response Contact:</td>
    <td>{{ liaison.response_contacts|parse_email_list|make_one_per_line|safe|linebreaksbr }}</td>
  </tr>

  <tr>
    <td>Technical Contact:</td>
    <td>{{ liaison.technical_contacts|parse_email_list|make_one_per_line|safe|linebreaksbr }}</td>
  </tr>


    {% if liaison.deadline %}
      <tr>
        <th class="text-nowrap">Deadline</th>
        <td>
          {{ liaison.deadline }}
          {% if liaison.action_taken %}
            <span class="actionTaken">Action Taken</span>
          {% else %}
            <span class="noActionTaken">Action Needed</span>
          {% endif %}
          {% if can_take_care %}
            <form method="post" role="form" class="pull-right">
	      {% csrf_token %}
	      <input class="btn btn-warning btn-xs" type="submit" value="Mark as action taken" name='do_action_taken'>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endif %}

    {% if relations %}
      <tr>
        <th class="text-nowrap">Liaisons referring to this</th>
        <td>
          {% for rel in relations %}
            <a href="{% url "liaison_detail" rel.pk %}">
	      {% if rel.title %}{{ rel.title }}{% else %}Liaison #{{ rel.pk }}{% endif %}
            </a>
            <br>
          {% endfor %}
        </td>
      </tr>
    {% endif %}

    {% if liaison.related_to %}
      {% if liaison.related_to.approved or is_approving %}
        <tr>
          <th class="text-nowrap">Referenced liaison</th>
          <td>
            <a href="{% url "liaison_detail" liaison.related_to.pk %}">
	      {% if liaison.related_to.title %}{{ liaison.related_to.title }}{% else %}Liaison #{{ liaison.related_to.pk }}{% endif %}
            </a>
          </td>
        </tr>
      {% endif %}
    {% endif %}

    <tr>
      <th class="text-nowrap">Attachments</th>
      <td>
        {% for doc in liaison.attachments.all %}
          <a href="//datatracker.ietf.org/documents/LIAISON/{{ doc.external_url }}">{{ doc.title }}</a>
          {% if not forloop.last %}<br>{% endif %}
        {% empty %}
          (None)
        {% endfor %}
      </td>
    </tr>

{% if relations_by %}
<tr>
  <td>Liaisons referred by this one:</td>
  <td>
    {% for rel in relations_by %}
      <a href="{% url "liaison_detail" rel.pk %}">{% if rel.title %}{{ rel.title }}{% else %}Liaison #{{ rel.pk }}{% endif %}</a><br />
    {% endfor %}
  </td>
</tr>
{% endif %}

{% if relations_to %}
<tr>
  <td>Liaisons referring to this one:</td>
  <td>
    {% for rel in relations_to %}
      <a href="{% url "liaison_detail" rel.pk %}">{% if rel.title %}{{ rel.title }}{% else %}Liaison #{{ rel.pk }}{% endif %}</a><br />
    {% endfor %}
  </td>
</tr>
{% endif %}

  {% if can_edit %}
    <p>
      <a class="btn btn-default" href="{% url "liaison_edit" object_id=liaison.pk %}">Edit liaison</a>
    </p>
  {% endif %}

{% endblock %}
