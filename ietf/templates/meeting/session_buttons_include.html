{# Copyright The IETF Trust 2015, All Rights Reserved #}
{% load origin %}
{% load static %}
{% load textfilters %}
{% load ietf_filters %}
{% origin %}

{% if item|should_show_agenda_session_buttons %}
    {% with slug=item.slug %}{% with session=item.session %}{% with timeslot=item.timeslot %}{% with meeting=schedule.meeting %}
        {% if session.agenda and show_agenda %}
            {# Note: if called with show_agenda=True, calling template must load agenda_materials.js, needed by session_agenda_include.html #}
            {% include "meeting/session_agenda_include.html" with slug=slug session=session timeslot=timeslot only %}
        {% endif %}

        <div id="session-buttons-{{session.pk}}" role="group" class="btn-group btn-group-sm">
            {% with acronym=session.historic_group.acronym %}
                {% if session.agenda and show_agenda %}
                    <!-- agenda pop-up button -->
                    <a class="btn btn-outline-primary" role="button" data-bs-toggle="modal" data-bs-target="#modal-{{slug}}" title="Show meeting materials"><span class="bi bi-arrows-fullscreen"></span></a>
                    <!-- materials tar file -->
                    <a class="btn btn-outline-primary" role="button" href="/meeting/{{meeting.number}}/agenda/{{acronym}}-drafts.tgz" title="Download meeting materials as .tar archive"><span class="bi bi-file-zip"></span></a>
                    <!-- materials PDF file -->
                    <a class="btn btn-outline-primary" role="button" href="/meeting/{{ meeting.number }}/agenda/{{acronym}}-drafts.pdf" title="Download meeting materials as PDF file"><span class="bi bi-file-pdf"></span></a>
                {% endif %}

                <!-- HedgeDoc -->
                {% if use_codimd %}
                    {% if timeslot.type.slug == 'plenary' %}
                        <a class="btn btn-outline-primary" role="button" href="https://notes.ietf.org/notes-ietf-{{ meeting.number }}-plenary" title="Notepad for note-takers"><span class="bi bi-journal-text"></span></a>
                    {% else %}
                        <a class="btn btn-outline-primary" role="button" href="https://notes.ietf.org/notes-ietf-{{ meeting.number }}-{{acronym}}" title="Notepad for note-takers"><span class="bi bi-journal-text"></span></a>
                    {% endif %}
                {% endif %}

                {# show stream buttons up till end of session, then show archive buttons #}
                {% if now < timeslot.utc_end_time %}
                    <!-- Jabber -->
                    <a class="btn btn-outline-primary" role="button"
                        href="xmpp:{{session.jabber_room_name}}@jabber.ietf.org?join"
                        title="Chat room for {{session.jabber_room_name}}"><span class="bi bi-lightbulb"></span></a>
                    <!-- Video stream (meetecho) -->
                    {% if timeslot.location.video_stream_url %}
                        <a class="btn btn-outline-primary" role="button"
                            href="{{timeslot.location.video_stream_url|format:session }}"
                            title="Video stream"><span class="bi bi-camera-video"></span></a>
                    {% endif %}
                    <!-- Audio stream -->
                    {% if timeslot.location.audio_stream_url %}
                        <a class="btn btn-outline-primary" role="button"
                            href="{{timeslot.location.audio_stream_url|format:session }}"
                            title="Audio stream"><span class="bi bi-headphones"></span></a>
                    {% endif %}
                    <!-- Remote call-in -->
                    {% if session.agenda_note|first_url|conference_url %}
                        <a class="btn btn-outline-primary" role="button"
                            href="{{ session.agenda_note|first_url }}"
                            title="Online conference"><span class="bi bi-people"></span></a>
                    {% elif session.remote_instructions|first_url|conference_url %}
                        <a class="btn btn-outline-primary" role="button"
                            href="{{ session.remote_instructions|first_url }}"
                            title="Online conference"><span class="bi bi-people"></span></a>
                    {% elif timeslot.location.webex_url %}
                        <a class="btn btn-outline-primary" role="button"
                            href="{{timeslot.location.webex_url|format:session }}"
                            title="Webex session"><span class="bi bi-people"></span></a>
                    {% endif %}
                    <!-- iCalendar item -->
                    <a class="btn btn-outline-primary" role="button"
                        href="{% url 'ietf.meeting.views.agenda_ical' num=meeting.number session_id=session.id %}"
                        title="icalendar entry for {{acronym}} session on {{timeslot.utc_start_time|date:'Y-m-d H:i'}} UTC">
                        <span class="bi bi-calendar"></span></a>
                {% else %}
                    <!-- Jabber logs -->
                    {% if meeting.number|add:"0" >= 60 %}
                        <a class="btn btn-outline-primary" role="button" href="https://www.ietf.org/jabber/logs/{{session.jabber_room_name}}?C=M;O=D" title="Chat logs for {{session.jabber_room_name}}"><i class="bi bi-file-text"></i></a>
                    {% endif %}
                    <!-- Recordings -->
                    {% if meeting.number|add:"0" >= 80 %}
                        {% with session.recordings as recordings %}
                            {% if recordings %}
                                {# There's no guaranteed order, so this is a bit messy: #}
                                <!-- First, the audio recordings, if any -->
                                {% for r in recordings %}
                                    {% if r.get_href and 'audio' in r.get_href %}
                                        <a class="btn btn-outline-primary" role="button" href="{{ r.get_href }}" title="{{ r.title}}"><span class="bi bi-file-play"></span></a>
                                    {% endif %}
                                {% endfor %}
                                <!-- Then the youtube recordings -->
                                {% for r in recordings %}
                                    {% if r.get_href and 'youtu' in r.get_href %}
                                        <a class="btn btn-outline-primary" role="button" href="{{ r.get_href }}" title="{{ r.title }}"><span class="bi bi-file-slides"></span></a>
                                    {% endif %}
                                {% endfor %}
                                <!-- Finally, any other recordings -->
                                {% for r in recordings %}
                                    {% if r.get_href and not 'audio' in r.get_href and not 'youtu' in r.get_href %}
                                        <a class="btn btn-outline-primary" role="button" href="{{ r.get_href }}" title="{{ r.title }}"><span class="bi bi-file-play"></span></a>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                        {% if timeslot.location.video_stream_url %}
                            <a class="btn btn-outline-primary" role="button"
                                href="http://www.meetecho.com/ietf{{meeting.number}}/recordings#{{acronym.upper}}"
                                title="Session recording"><span class="bi bi-file-slides"></span></a>
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endwith %}
        </div>
    {% endwith %}{% endwith %}{% endwith %}{% endwith %}
{% endif %}